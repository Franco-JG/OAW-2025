<?php
 namespace OAW\Backend\Models; class News { private $conn; public function __construct($db) { $this->conn = $db; } public function getNews($orderBy = "pub_date") { $allowedColumns = ["title", "description", "pub_date", "created_at"]; if (!in_array($orderBy, $allowedColumns)) { $orderBy = "pub_date"; } $sql = "SELECT * FROM news ORDER BY $orderBy ASC"; $result = $this->conn->query($sql); return $result->fetch_all(MYSQLI_ASSOC); } public function searchNews($query) { if ($query === "") { return "La búsqueda no puede estar vacía"; } $stmt = $this->conn->prepare("SELECT * FROM news WHERE title LIKE ? OR description LIKE ?"); $search = "%$query%"; $stmt->bind_param("ss", $search, $search); $stmt->execute(); $result = $stmt->get_result(); $response = $result->fetch_all(MYSQLI_ASSOC); return (!$response)? "Sin resultados" : $response; } public function addNews($feed_id, $title, $description, $link, $pub_date, $categories = null) { $stmt = $this->conn->prepare("
            INSERT INTO news (feed_id, title, description, link, pub_date, categories)
            VALUES (?, ?, ?, ?, ?, ?)
        "); $stmt->bind_param("isssss", $feed_id, $title, $description, $link, $pub_date, $categories); return $stmt->execute(); } public function linkExists($link) { $query = "SELECT 1 FROM news WHERE link = ? LIMIT 1"; $stmt = $this->conn->prepare($query); $stmt->bind_param("s", $link); $stmt->execute(); $result = $stmt->get_result(); return $result->num_rows > 0; } } ?>